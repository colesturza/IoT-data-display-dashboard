{% extends "layout.html" %}
{% block title %}
Home
{% endblock %}
{% block content %}

<h1 class="mt-5">A Title</h1>

<p class="lead">Home page for the Visual Studio Code Flask tutorial.</p>

<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <canvas id="myChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const ctx = document.getElementById('myChart').getContext('2d');
    const labels = [65, 59, 80, 81, 56, 55, 40];
    const data = {
        labels: labels,
        datasets: [{
            label: 'My First Dataset',
            data: [65, 59, 80, 81, 56, 55, 40],
            fill: false,
            backgroundColor: "rgb(75, 192, 192)",
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.1
        }]
    };
    const config = {
        type: 'line',
        data: data,
    };
    const myChart = new Chart(ctx, config);

    const dataAPI = "http://127.0.0.1:5000/api/data";
    const updateChart = function () {

        $.getJSON(dataAPI, function (result) {

            myChart.data.labels = result.x;

            myChart.data.datasets.pop();
            myChart.data.datasets.push({
                label: 'My First Dataset',
                data: result.y,
                fill: false,
                backgroundColor: "rgb(75, 192, 192)",
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            });

            myChart.update();

        });
    }
    setInterval(function () { updateChart() }, 1000);

</script>

{% endblock %}